<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THREE CIRCLES</title>
<style>
    body {
        display: flex;
        user-select: none;
        touch-action: none;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
    }
    /* Container for the circles */
    #circle-container {
        position: relative;
        user-select: none;
        touch-action: none;
        width: 90vw;
        height: 90vw;
        max-width: 500px;
        max-height: 500px;
        background-color: #f0f0f0;
    }
    /* Common styles for all circles */
    .circle {
        position: absolute;
        border-radius: 50%;
        cursor: pointer;
        user-select: none;
        touch-action: none; /* Prevent default touch actions */
    }
    #circle-red {
        width: 100px;
        height: 100px;
        transform: scale(1);
        transform-origin: center; /* Scale from the center */
        top: 77%;
        left: 50%;
        background-color: red;
    }
    #circle-blue {
        width: 100px;
        height: 100px;
        transform: scale(1);
        transform-origin: center; /* Scale from the center */
        top: 33%;
        left: 10%;
        background-color: blue;
    }
    #circle-green {
        width: 100px;
        height: 100px;
        transform: scale(1);
        transform-origin: center;   /* Scale from the center */
        top: 33%;
        left: 90%;
        background-color: green;
    }
  </style>
</head>
<body>
    

<a>
    <div id="circle-container">
        <div id="circle-red" class="circle"></div>
        <div id="circle-blue" class="circle"></div>
        <div id="circle-green" class="circle"></div>
    </div>
</a>


<script>


// Three Circles resizing and data submission script
//
// Written by Glen Millar 2025, liberally employing code from the Three Circle app
//
// Free to use and modify under the MIT license
// https://opensource.org/license/mit/
//


let isResizing = false; 
let initialScale = 1;
let startX, startY;
let selectedCircle = null;


    // Function to get the current scale of a circle
function getScale(circle) {
    const computedTransform = window.getComputedStyle(circle).transform;
    const scaleMatch = computedTransform.match(/matrix\(([^)]+)\)/);
    if (scaleMatch) {
        const values = scaleMatch[1].split(', ');
        return parseFloat(values[0]); // Assuming uniform scaling
    }
    return 1;
}


// Function to submit the sizes of the circles
function submitSizes() {
    //  Get the current scales of each circle
    const redCircle = document.getElementById('circle-red');
    const blueCircle = document.getElementById('circle-blue');
    const greenCircle = document.getElementById('circle-green');


    // Get computed styles to extract the transform property
    const redTransform = window.getComputedStyle(redCircle).transform;
    const blueTransform = window.getComputedStyle(blueCircle).transform;
    const greenTransform = window.getComputedStyle(greenCircle).transform;
   

    // Extract scale values from the transform matrices
    const redScale = getScale(redCircle);
    const blueScale = getScale(blueCircle);
    const greenScale = getScale(greenCircle);


    // Prepare the message to send
    const message = {
        redCircle: redScale || "N/A",
        blueCircle: blueScale || "N/A",
        greenCircle: greenScale || "N/A"
    };
    console.log("submitting circle size data to Qualtrics:", message);   // For debugging
    window.parent.postMessage(message, "*"); // Send the message to the parent window
}



// Mouse event handlers
//
// Mousedown event to start resizing
//
function onMouseDown(e) { // Only start if a circle is clicked
    if (!e.target.classList.contains('circle')) return;
    e.preventDefault();
    isResizing = true;
    selectedCircle = e.target;
    startX = e.clientX;
    startY = e.clientY;

    // Extract the current scale from the transform style
    const computedTransform = window.getComputedStyle(selectedCircle).transform;
    const scaleMatch = computedTransform.match(/matrix\(([^)]+)\)/); // Match values inside matrix()
    if (scaleMatch) {
        const values = scaleMatch[1].split(', '); // For a 2D or 3D matrix, scaleX is the first value.
        initialScale = parseFloat(values[0]); 
    } else {
        initialScale = 1;
    }
    selectedCircle.style.cursor = 'grabbing';
}

// Mousemove event to resize the circle
function onMouseMove(e) {
    if (!isResizing || !selectedCircle) return;
    e.preventDefault();
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    const delta = Math.max(deltaX, deltaY);
    let newScale = initialScale + delta / 200;
    newScale = Math.max(0.25, Math.min(newScale, 10));
    selectedCircle.style.transform = `scale(${newScale})`;
}

// Mouseup event to stop resizing and submit sizes
function onMouseUp(e) {
    if (isResizing) {
        isResizing = false;
        if (selectedCircle) {
            selectedCircle.style.cursor = 'pointer';
        }
        selectedCircle = null;
    }
    submitSizes();
}

// Set up event listeners for circles and document
function setEventListeners () {
    const circles = document.getElementsByClassName('circle');
    for (let i = 0; i < circles.length; i++) {
        circles[i].addEventListener("mousedown", onMouseDown);
    }
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
}


// Initialize event listeners on page load
window.onload = () => {
    setEventListeners();

    // Deactivated code
    //
    // Checks for existing cookie and set if not present
    //
    // let name = "circleSurveyData";
    // const checkCookies = setInterval(() => {
    //     const cookieName = name + '=';
    //     const decodedCookie = decodeURIComponent(document.cookie);
    //     const cookieArray = decodedCookie.split(';');
    //     let found = false;
    //     for (let i = 0; i < cookieArray.length; i++) {
    //         let cookie = cookieArray[i].trim();
    //         if (cookie.indexOf(cookieName) === 0) {
    //             found = true;
    //             break;
    //         }
    //     }
    //     if (!found) {
    //         document.cookie = `${name}=; path=/; max-age=${60*60*24*30}`; // Expires in 30 days
    //         clearInterval(checkCookies);
    //     }
    // }, 100);
    //
    // 
}

</script>
</body>
</html>




